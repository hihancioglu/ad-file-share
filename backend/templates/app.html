<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Share</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="d-flex">
    <nav id="sidebar" class="collapse collapse-horizontal show bg-light border-end" style="--bs-collapse-width: 250px;">
        <div class="p-3">
            <h5>Menü</h5>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link" href="#upload">Yükle</a></li>
                <li class="nav-item"><a class="nav-link" href="#files">Dosyalarım</a></li>
            </ul>
        </div>
    </nav>

    <div class="flex-grow-1 p-3">
        <button class="btn btn-outline-secondary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar" aria-controls="sidebar">
            &#9776;
        </button>
        <h1>Hoş geldin, <span id="username-display"></span></h1>

        <section id="upload" class="mb-4">
            <h2>Dosya Yükle</h2>
            <form id="upload-form" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" class="form-control" name="file" required>
                </div>
                <button type="submit" class="btn btn-primary">Yükle</button>
            </form>
            <div id="upload-result" class="mt-2"></div>
        </section>

        <section id="files">
            <h2>Dosyalarım</h2>
            <ul id="file-list" class="list-group"></ul>
        </section>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const username = localStorage.getItem('username');
if (!username) {
    window.location.href = '/';
}

document.getElementById('username-display').textContent = username;

async function loadFiles() {
    const formData = new FormData();
    formData.append('username', username);
    const res = await fetch('/list', { method: 'POST', body: formData });
    const json = await res.json();
    const list = document.getElementById('file-list');
    list.innerHTML = '';
    json.files.forEach(file => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = file;
        list.appendChild(li);
    });
}

loadFiles();

document.getElementById('upload-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    formData.append('username', username);
    const res = await fetch('/upload', { method: 'POST', body: formData });
    const json = await res.json();
    const result = document.getElementById('upload-result');
    if (json.success) {
        result.innerHTML = '<div class="alert alert-success">Yüklendi</div>';
        loadFiles();
    } else {
        result.innerHTML = '<div class="alert alert-danger">' + (json.error || 'Hata') + '</div>';
    }
});
</script>
</body>
</html>
